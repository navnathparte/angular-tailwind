<div class="bg-white rounded-lg shadow h-full flex flex-col">
  <!-- Filters -->

  <div class="p-4 border-b bg-gray-50 flex flex-wrap gap-3 items-center">
    <!-- Rows per page -->
    <div class="flex items-center gap-2 text-sm text-gray-600">
      <span>Rows per page:</span>
      <select
        [ngModel]="rowsPerPage()"
        (ngModelChange)="rowsPerPage.set($event); page.set(1)"
        class="border border-gray-300 rounded px-2 py-1 bg-white text-sm"
      >
        @for (size of config.pageSizeOptions || [5, 10, 25, 50]; track size) {
          <option [value]="size">{{ size }}</option>
        }
      </select>
    </div>

    <!-- Filters -->
    @for (f of config.filters; track f.key) {
      <select
        [ngModel]="filters()[f.key]"
        (ngModelChange)="updateFilter(f.key, $event)"
        class="border rounded-lg px-3 py-2 text-sm bg-white"
      >
        <option value="">{{ f.label }}</option>
        @for (opt of f.options; track opt) {
          <option [value]="opt">{{ opt }}</option>
        }
      </select>
    }

    <!-- Search -->
    <input
      [ngModel]="search()"
      (ngModelChange)="search.set($event); page.set(1)"
      placeholder="Search"
      class="ml-auto border rounded-lg px-3 py-2 text-sm w-64"
    />
  </div>

  <!-- Scrollable Table -->
  <div
    [ngClass]="tableAutoHeight() ? 'overflow-x-auto' : 'flex-1 overflow-auto'"
    class="relative table-scroll"
  >
    @if (tableAutoHeight()) {
      <div class="h-40 bg-gradient-to-b from-white to-gray-50"></div>
    }
    @if (loading()) {
      <div class="p-6 space-y-4 animate-pulse">
        @for (i of [1, 2, 3, 4, 5, 6]; track i) {
          <div class="grid grid-cols-12 gap-4">
            @for (c of config.columns; track c.key) {
              <div class="h-4 bg-gray-200 rounded col-span-1"></div>
            }
          </div>
        }
      </div>
    } @else if (filtered().length > 0) {
      <table class="w-full min-w-max border-collapse">
        <thead class="sticky top-0 bg-white z-40">
          <tr>
            @for (col of config.columns; track col.key) {
              <th
                class="px-4 py-3 text-xs font-semibold uppercase bg-white"
                [ngClass]="[
                  col.width,
                  col.sticky === 'left' ? 'sticky left-0 z-50 border-r bg-white' : '',
                  col.sticky === 'right' ? 'sticky right-0 z-50 border-l bg-white' : '',
                ]"
                [style.left]="col.sticky === 'left' ? col.stickyOffset : null"
                [style.right]="col.sticky === 'right' ? col.stickyOffset : null"
              >
                {{ col.label }}
              </th>
            }
          </tr>
        </thead>

        <tbody>
          @for (row of paginated(); track row.id) {
            <tr class="hover:bg-gray-50">
              @for (col of config.columns; track col.key) {
                <td
                  class="px-4 py-3 text-sm whitespace-nowrap bg-white"
                  [ngClass]="[
                    col.width,
                    col.sticky === 'left' ? 'sticky left-0 z-30 border-r bg-white' : '',
                    col.sticky === 'right' ? 'sticky right-0 z-30 border-l bg-white' : '',
                  ]"
                  [style.left]="col.sticky === 'left' ? col.stickyOffset : null"
                  [style.right]="col.sticky === 'right' ? col.stickyOffset : null"
                >
                  @switch (col.type) {
                    @case ('action') {
                      <button
                        (click)="actionClick.emit(row)"
                        class="px-3 py-1 bg-blue-600 text-white text-xs rounded"
                      >
                        {{ row.status }}
                      </button>
                    }
                    @default {
                      <span>
                        {{ col.truncate ? truncate(row[col.key], col.truncate) : row[col.key] }}
                      </span>
                    }
                  }
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    } @else {
      <div class="flex items-center justify-center h-full bg-white">
        <div class="text-center">
          <div class="text-5xl mb-3">ðŸ“­</div>
          <p class="text-gray-500 text-sm font-medium">No records available</p>
          <p class="text-gray-400 text-xs mt-1">There is no data to display</p>
        </div>
      </div>
    }
  </div>

  <!-- Footer -->
  <div class="p-4 border-t bg-gray-50 flex justify-end items-center">
    <div class="flex gap-1 items-center text-sm">
      <button
        (click)="page.set(page() - 1)"
        [disabled]="page() === 1"
        class="px-2 py-1 border rounded disabled:opacity-40"
      >
        Prev
      </button>

      @for (p of pages(); track p) {
        <button
          (click)="page.set(p)"
          class="px-3 py-1 border rounded"
          [ngClass]="
            page() === p
              ? 'bg-blue-600 text-white border-blue-600'
              : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
          "
        >
          {{ p }}
        </button>
      }

      <button
        (click)="page.set(page() + 1)"
        [disabled]="page() === totalPages()"
        class="px-2 py-1 border rounded disabled:opacity-40"
      >
        Next
      </button>
    </div>
  </div>
</div>

<!-- Modal -->
@if (modalOpen()) {
  <div class="fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow max-w-lg w-full">
      <div class="flex justify-between mb-4">
        <h3 class="font-semibold">{{ modalTitle() }}</h3>
        <button (click)="modalOpen.set(false)">âœ•</button>
      </div>
      <p class="text-sm whitespace-pre-line">{{ modalContent() }}</p>
    </div>
  </div>
}
