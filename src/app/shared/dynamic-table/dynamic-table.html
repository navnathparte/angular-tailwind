<div class="bg-white rounded-lg shadow h-full flex flex-col">
  <!-- TOP FILTER BAR -->
  <div class="p-4 border-b border-gray-200 bg-gray-50">
    <div class="flex flex-wrap items-center justify-between gap-4">
      <!-- LEFT : Rows per page -->
      <div>
        <select
          [ngModel]="rowsPerPage()"
          (ngModelChange)="rowsPerPage.set($event); page.set(1)"
          class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-sm shadow-sm"
        >
          @for (r of config.pageSizeOptions || [5, 10, 25, 50]; track r) {
            <option [value]="r">{{ r }}</option>
          }
        </select>
      </div>

      <!-- CENTER : Filters -->
      <div class="flex flex-wrap items-center gap-3 justify-center flex-1">
        <select
          [ngModel]="filters().function"
          (ngModelChange)="updateFilter('function', $event)"
          class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-sm shadow-sm"
        >
          <option value="">Select Function</option>
          @for (f of functionOptions(); track f) {
            <option [value]="f">{{ f }}</option>
          }
        </select>

        <select
          [ngModel]="filters().account"
          (ngModelChange)="updateFilter('account', $event)"
          class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-sm shadow-sm"
        >
          <option value="">Select Account</option>
          @for (f of accountOptions(); track f) {
            <option [value]="f">{{ f }}</option>
          }
        </select>

        <select
          [ngModel]="filters().process"
          (ngModelChange)="updateFilter('process', $event)"
          class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-sm shadow-sm"
        >
          <option value="">Select Process</option>
          @for (f of processOptions(); track f) {
            <option [value]="f">{{ f }}</option>
          }
        </select>

        <select
          [ngModel]="filters().supervisor"
          (ngModelChange)="updateFilter('supervisor', $event)"
          class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-sm shadow-sm"
        >
          <option value="">Select Manager</option>
          @for (f of supervisorOptions(); track f) {
            <option [value]="f">{{ f }}</option>
          }
        </select>

        <!-- Filter Button -->
        <button class="p-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
            />
          </svg>
        </button>

        <!-- Refresh -->
        <button
          (click)="refreshTable()"
          class="p-2 border border-gray-300 bg-white rounded-lg shadow hover:bg-gray-50"
        >
          <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            />
          </svg>
        </button>
      </div>

      <!-- RIGHT : Search -->
      <div class="relative">
        <input
          [ngModel]="search()"
          (ngModelChange)="search.set($event); page.set(1)"
          placeholder="Search here"
          class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg text-sm shadow-sm w-64 bg-white"
        />
        <svg
          class="w-5 h-5 text-gray-400 absolute left-3 top-2.5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>
    </div>
  </div>

  <!-- Scrollable Table -->
  <div
    [ngClass]="tableAutoHeight() ? 'overflow-x-auto' : 'flex-1 overflow-auto'"
    class="relative table-scroll"
  >
    @if (tableAutoHeight()) {
      <div class="h-40 bg-gradient-to-b from-white to-gray-50"></div>
    }
    @if (loading()) {
      <div class="p-6 space-y-4 animate-pulse">
        @for (i of [1, 2, 3, 4, 5, 6]; track i) {
          <div class="grid grid-cols-12 gap-4">
            @for (c of config.columns; track c.key) {
              <div class="h-4 bg-gray-200 rounded col-span-1"></div>
            }
          </div>
        }
      </div>
    } @else if (filtered().length > 0) {
      <table class="w-full min-w-max border-collapse">
        <thead class="sticky top-0 bg-white z-40">
          <tr>
            @for (col of config.columns; track col.key) {
              <th
                class="px-4 py-3 text-xs font-semibold uppercase bg-white"
                [ngClass]="[
                  col.width,
                  col.sticky === 'left' ? 'sticky left-0 z-50 border-r bg-white' : '',
                  col.sticky === 'right' ? 'sticky right-0 z-50 border-l bg-white' : '',
                ]"
                [style.left]="col.sticky === 'left' ? col.stickyOffset : null"
                [style.right]="col.sticky === 'right' ? col.stickyOffset : null"
              >
                {{ col.label }}
              </th>
            }
          </tr>
        </thead>

        <tbody>
          @for (row of paginated(); track row.id) {
            <tr class="hover:bg-gray-50">
              @for (col of config.columns; track col.key) {
                <td
                  class="px-4 py-3 text-sm whitespace-nowrap bg-white"
                  [ngClass]="[
                    col.width,
                    col.sticky === 'left' ? 'sticky left-0 z-30 border-r bg-white' : '',
                    col.sticky === 'right' ? 'sticky right-0 z-30 border-l bg-white' : '',
                  ]"
                  [style.left]="col.sticky === 'left' ? col.stickyOffset : null"
                  [style.right]="col.sticky === 'right' ? col.stickyOffset : null"
                >
                  @switch (col.type) {
                    @case ('action') {
                      <button
                        (click)="actionClick.emit(row)"
                        class="px-3 py-1 bg-blue-600 text-white text-xs rounded"
                      >
                        {{ row.status }}
                      </button>
                    }
                    @default {
                      <span>
                        {{ col.truncate ? truncate(row[col.key], col.truncate) : row[col.key] }}
                      </span>
                    }
                  }
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    } @else {
      <div class="flex items-center justify-center h-full bg-white">
        <div class="text-center">
          <div class="text-5xl mb-3">ðŸ“­</div>
          <p class="text-gray-500 text-sm font-medium">No records available</p>
          <p class="text-gray-400 text-xs mt-1">There is no data to display</p>
        </div>
      </div>
    }
  </div>

  <!-- Footer -->
  <div class="p-4 border-t bg-gray-50 flex justify-between items-center">
    <!-- Showing Count -->
    <div class="text-sm text-gray-600">
      Showing {{ startRecord() }} to {{ endRecord() }} of {{ filtered().length }} results
    </div>

    <div class="flex gap-1 items-center text-sm">
      <button
        (click)="page.set(page() - 1)"
        [disabled]="page() === 1"
        class="px-2 py-1 border rounded disabled:opacity-40"
      >
        Prev
      </button>

      @for (p of pages(); track p) {
        <button
          (click)="page.set(p)"
          class="px-3 py-1 border rounded"
          [ngClass]="
            page() === p
              ? 'bg-blue-600 text-white border-blue-600'
              : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-50'
          "
        >
          {{ p }}
        </button>
      }

      <button
        (click)="page.set(page() + 1)"
        [disabled]="page() === totalPages()"
        class="px-2 py-1 border rounded disabled:opacity-40"
      >
        Next
      </button>
    </div>
  </div>
</div>

<!-- Modal -->
@if (modalOpen()) {
  <div class="fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow max-w-lg w-full">
      <div class="flex justify-between mb-4">
        <h3 class="font-semibold">{{ modalTitle() }}</h3>
        <button (click)="modalOpen.set(false)">âœ•</button>
      </div>
      <p class="text-sm whitespace-pre-line">{{ modalContent() }}</p>
    </div>
  </div>
}
